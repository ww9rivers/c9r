-*- mode:python; -*-
Unit tests for ../csvio.py.

Test 1: This test fails, although the output is the same as expected,
        Possibly because of CR-LF issue with CVS writer.

    >>> import os, sys
    >>> if 'DEBUG' in os.environ:
    ...   import c9r.pylog
    ...   c9r.pylog.set_debug()

    >>> import csv
    >>> from io import StringIO
    >>> from c9r.util.filter import Filter
    >>> from c9r.util.filter.csvio import Reader, Writer
    >>> class Ofilter(Filter):
    ...   def close(self):
    ...     pass # Do not close on sys.stdout
    ...   def write(self, data):
    ...     Filter.write(self, unicode(data))
    >>> header = [ 'MACAddress','User','LastSessionLength' ]
    >>> tdata = StringIO(u'''
    ... 1A-2B-3C:4D-5E-6F,Domain-nUser,1 days 2 hrs 35 min 55 sec
    ... 00:18:fe:8a:e0:3c,"Domain-User",3 hrs 47 min 26 sec
    ... ''')
    >>> xout = StringIO()
    >>> with Reader(tdata) as xr:
    ...   with Writer(Ofilter(xout), header) as xt:
    ...     for data in csv.DictReader(xr, header):
    ...       try:
    ...         xt.write(data)
    ...       except ValueError as ex:
    ...         pass
    ...     xt.write({'MACAddress': '11:22:33:44:55:66',
    ...               'User': "plainuser",
    ...               'LastSessionLength': '2 hrs 10 min 01 sec'
    ...               })
    >>> xout.tell() > 0L
    True
    >>> xout.seek(0)
    0L
    >>> print(xout.readlines())
    [u'MACAddress,User,LastSessionLength\r\n', u'1A-2B-3C:4D-5E-6F,Domain-nUser,1 days 2 hrs 35 min 55 sec\r\n', u'00:18:fe:8a:e0:3c,Domain-User,3 hrs 47 min 26 sec\r\n', u'11:22:33:44:55:66,plainuser,2 hrs 10 min 01 sec\r\n']

Test 2: Close writer that writes header but no data is written.

    >>> xt = Writer(Ofilter(sys.stdout), header, write_header=True)
    >>> xt.close()
